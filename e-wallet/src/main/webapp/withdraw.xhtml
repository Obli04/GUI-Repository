<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:head>
    <title>Withdraw - CashHive</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&amp;display=swap" rel="stylesheet"/>
    <h:outputStylesheet library="styles" name="withdrawal.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</h:head>
<h:body>
    <h:form>
        <f:websocket channel="payment" onmessage="handlePayment" />
        <ui:include src="navbar.xhtml"/>
    </h:form>

    <div class="content">
        <div class="container">
            <div class="balance-header">
                Current Balance: 
                <h:outputText value="#{userBean.currentUser.balance}" styleClass="balance-text">
                    <f:convertNumber type="currency" currencySymbol="Kč"/>
                </h:outputText>
            </div>
            
            <p:card styleClass="modern-card">
                <h:form id="withdrawForm">
                    <p:panel styleClass="modern-panel">
                        <div class="modern-grid">
                            <div class="modern-col">
                                <p:outputLabel for="recipientBank" value="Bank Name:" styleClass="modern-label"/>
                                <p:inputText id="recipientBank" 
                                           value="#{withdrawalBean.recipientBank}"
                                           required="true"
                                           placeholder="Enter bank name"
                                           styleClass="modern-input"/>
                            </div>

                            <div class="modern-col">
                                <p:outputLabel for="countryCode" value="Country:" styleClass="modern-label"/>
                                <p:selectOneMenu id="countryCode" value="#{withdrawalBean.countryCode}" 
                                               required="true" styleClass="modern-input">
                                    <f:selectItem itemLabel="Select Country" itemValue=""/>
                                    <f:selectItem itemLabel="Austria (AT)" itemValue="AT"/>
                                    <f:selectItem itemLabel="Belgium (BE)" itemValue="BE"/>
                                    <f:selectItem itemLabel="Bulgaria (BG)" itemValue="BG"/>
                                    <f:selectItem itemLabel="Croatia (HR)" itemValue="HR"/>
                                    <f:selectItem itemLabel="Cyprus (CY)" itemValue="CY"/>
                                    <f:selectItem itemLabel="Czech Republic (CZ)" itemValue="CZ"/>
                                    <f:selectItem itemLabel="Denmark (DK)" itemValue="DK"/>
                                    <f:selectItem itemLabel="Estonia (EE)" itemValue="EE"/>
                                    <f:selectItem itemLabel="Finland (FI)" itemValue="FI"/>
                                    <f:selectItem itemLabel="France (FR)" itemValue="FR"/>
                                    <f:selectItem itemLabel="Germany (DE)" itemValue="DE"/>
                                    <f:selectItem itemLabel="Greece (GR)" itemValue="GR"/>
                                    <f:selectItem itemLabel="Hungary (HU)" itemValue="HU"/>
                                    <f:selectItem itemLabel="Ireland (IE)" itemValue="IE"/>
                                    <f:selectItem itemLabel="Italy (IT)" itemValue="IT"/>
                                    <f:selectItem itemLabel="Latvia (LV)" itemValue="LV"/>
                                    <f:selectItem itemLabel="Lithuania (LT)" itemValue="LT"/>
                                    <f:selectItem itemLabel="Luxembourg (LU)" itemValue="LU"/>
                                    <f:selectItem itemLabel="Malta (MT)" itemValue="MT"/>
                                    <f:selectItem itemLabel="Netherlands (NL)" itemValue="NL"/>
                                    <f:selectItem itemLabel="Poland (PL)" itemValue="PL"/>
                                    <f:selectItem itemLabel="Portugal (PT)" itemValue="PT"/>
                                    <f:selectItem itemLabel="Romania (RO)" itemValue="RO"/>
                                    <f:selectItem itemLabel="Slovakia (SK)" itemValue="SK"/>
                                    <f:selectItem itemLabel="Slovenia (SI)" itemValue="SI"/>
                                    <f:selectItem itemLabel="Spain (ES)" itemValue="ES"/>
                                    <f:selectItem itemLabel="Sweden (SE)" itemValue="SE"/>
                                    <p:ajax update="recipientIBAN" listener="#{withdrawalBean.updateIBANPrefix}"/>
                                </p:selectOneMenu>
                            </div>

                            <div class="modern-col">
                                <p:outputLabel for="recipientIBAN" value="IBAN Number:" styleClass="modern-label"/>
                                <p:inputText id="recipientIBAN" 
                                           value="#{withdrawalBean.recipientIBAN}"
                                           required="true"
                                           maxlength="32"
                                           placeholder="Enter IBAN"
                                           styleClass="modern-input"/>
                            </div>

                            <div class="modern-col">
                                <p:outputLabel for="amount" value="Amount:" styleClass="modern-label"/>
                                <p:inputNumber id="amount" 
                                             value="#{withdrawalBean.amount}" 
                                             symbol="Kč" 
                                             decimalPlaces="2"
                                             required="true"
                                             minValue="0.01"
                                             styleClass="modern-input"/>
                            </div>
                        </div>
                        
                        <p:messages id="messages" showDetail="true" closable="true" styleClass="modern-messages">
                            <p:autoUpdate/>
                        </p:messages>
                        
                        <div class="button-container">
                            <p:commandButton value="Withdraw" 
                                           action="#{withdrawalBean.withdraw}"
                                           update="@form"
                                           styleClass="modern-button-success"/>
                            <p:button value="Cancel" 
                                     outcome="dashboard"
                                     styleClass="modern-button-secondary"/>
                        </div>
                    </p:panel>
                </h:form>
            </p:card>
        </div>
    </div>
</h:body>
</html>
